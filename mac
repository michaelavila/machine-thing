#!/usr/bin/env sh

export MAC_PATH="$(cd "$(dirname "$0")"; pwd -P)" # the location of this script
MAC_LIB="$MAC_PATH/lib"                           # things used by macrc
MAC_MODULES="$MAC_PATH/modules"                   # modularized setups

lib() { source "$MAC_LIB/$1.sh"; }

lib 'utils'
lib 'colors'

# ensure that a module is installed and configured to be used
#
module() {
  echo "${Blu}starting module: ${BBlu}${1}${RCol}"
  local module_path="${MAC_MODULES}/${1}"
  [ -d "${MAC_MODULES}" ] || fail "no modules at (${MAC_MODULES})"
  [ -d "${module_path}" ] || fail "module (${module_path}) does not exist!"
  pushd "${module_path}"

  # 1) brew up osx goodness
  [ -f Brewfile ] && brew bundle --file="${module_path}/Brewfile" >/dev/null
  [ -f Brewfile ] && [ $? -eq 0 ] && echo "* ${Pur}brewed${RCol}"

  # 2) run any manual installation steps
  [ -x install ] && ./install
  [ -x install ] && [ $? -eq 0 ] && echo "* ${Pur}installed${RCol}"

  popd
  echo "${Gre}finished module: ${BGre}${1}${RCol}"
}

# not required, but most things depend on homebrew

module 'homebrew'

# to setup the machine, list the modules that apply

module 'dotfiles'
module 'terminal'
module 'vim'

module 'java'
module 'sophos'
