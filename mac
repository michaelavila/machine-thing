export MAC_PATH="$(cd "$(dirname "$0")"; pwd -P)" # the location of this script
MAC_LIB="$MAC_PATH/lib"                           # things used by macrc
MAC_MODULES="$MAC_PATH/modules"                   # modularized setups

lib() { source "$MAC_LIB/$1.sh"; }

lib 'utils'

# ensure that a module is installed and configured to be used
#
module() {
  echo "starting module: ${1}"
  local module_path="${MAC_MODULES}/${1}"
  [ -d "${MAC_MODULES}" ] || fail "no modules at (${MAC_MODULES})"
  [ -d "${module_path}" ] || fail "module (${module_path}) does not exist!"
  pushd "${module_path}"

  # 1) run any manual installation steps
  [ -x install ] && ./install

  # 2) brew up osx goodness
  [ -f Brewfile ] && brew bundle --file="${module_path}/Brewfile"

  popd
  echo "finished module: ${1}"
}

# not required, but most things depend on homebrew

module 'homebrew'

# to setup the machine, list the modules that apply

module 'dotfiles'
module 'terminal'
module 'vim'

module 'java'
module 'sophos'
